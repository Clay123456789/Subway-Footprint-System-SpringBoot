# 本地与远程服务器信息

远程服务器mysql数据库管理后台网址

http://123.56.150.89:888/phpmyadmin_0dcf81ed7004a964/db_structure.php?server=1&db=server_db

用户名：server_db

密码：FULINTAO0709

```bash
#后端本地服务器ip和端口号
server.host=192.168.232.1
server.port=8888
#远程服务器mysql数据库
spring.datasource.url=jdbc:mysql://123.56.150.89:3306/server_db
spring.datasource.username=server_db
spring.datasource.password=FULINTAO0709
#远程服务器redis数据库
spring.redis.host=123.56.150.89
spring.redis.port= 6379
spring.redis.password=123456
```

# 数据库选择方案：

Mysql和redis配合使用，使用redis做缓存，将用户访问频繁的数据放在缓存中，以提高响应速度。

在接受前端发来的访问请求时，进行以下操作：

* 查询：

  前端发来请求时，先从缓存redis中进行查询，如果缓存存在要查询的数据，则返回。否则去mysql数据库中查询，成功查询数据后添加其到缓存中并设定有效时间，再返回数据，这样在一定时间内再次查询该数据时，便可直接从缓存中取，提高查询效率。

* 增加：

  直接添加到mysql数据库,将缓存中数据所在表删除（为了保证selectAll获取数据一致）。

* 删除：

  先删除mysql数据库，再将缓存的数据删除即可。

* 修改：

  先修改mysql数据库，再将缓存的数据删除即可，不直接更新缓存，效率太低。

# mysql数据库设计

## 城市地铁信息表———Subway

![image-20211216004901468](https://cdn.jsdelivr.net/gh/Clay123456789/picture_bed/img/image-20211216004901468.png)

该表主要存储从百度api（http://map.baidu.com/和https://api.map.baidu.com/）获取并解析出的地铁数据，作为项目绘制地铁图的数据来源。

* 其中，属性l_xmlatter存储json字段结构如下：![image-20211216005342262](https://cdn.jsdelivr.net/gh/Clay123456789/picture_bed/img/image-20211216005342262.png)

  其中，lid为路线id，lb为别名，lbx和lby为绘制时文字的偏移量，uid是可辨识的唯一属性。

* 属性p存储json字段结构如下：

  ![image-20211216010511444](https://cdn.jsdelivr.net/gh/Clay123456789/picture_bed/img/image-20211216010511444.png)

  其中，每个p_xmlattar表示一个站点信息，sid为站点id,lb为站名，x和y为站点坐标，rx和ry为绘制时文字偏移量，st表示是否为站点，ex表示是否为中转站，ln为所在线路，uid是可辨识的唯一属性。

## 用户表——User

![image-20211216012133366](https://cdn.jsdelivr.net/gh/Clay123456789/picture_bed/img/image-20211216012133366.png)

该表存储用户的基本信息。

## 用户点亮的地铁站表——lightedstation_xxx

![image-20211216012754291](https://cdn.jsdelivr.net/gh/Clay123456789/picture_bed/img/image-20211216012754291.png)

该表存储uid为xxx的用户点亮地铁站的相关信息，每位用户对应一张表。

# 接口api

```
url=http://ip:8888/xxx

下面为get请求：
 /*
 * 请求方式：get
 * 功能：获取指定/所有城市铁路信息
 * 路径 /Subway/getAllSubways
 * 传参(json) code(0代表所有)
 * 返回值(json) String（用Result封装json中会有转义符干扰，故此接口直接返回结果）
 * */
 
 
 /*
 * 请求方式：get
 * 功能：上传所有城市铁路信息
 * 路径 /Subway/uploadAllSubways
 * 传参(json) null
 * 返回值(json--Result) code,message,data(boolean)
 * */

 /*
 * 请求方式：post
 * 功能：登陆
 * 路径 /user/login
 * 传参(json) uid
 * 返回值(json--Result) code,message,data(str)
 * */
     
 
 /*
 * 请求方式：post
 * 功能：发送注册邮箱
 * 路径 /user/sendRegisterEmail
 * 传参(json) email
 * 返回值(json--Result) code,message,data(str)
 * */

 /*
 * 请求方式：post
 * 功能：注册新用户
 * 路径 /user/regist
 * 传参(json) username,password,email,code
 * 返回值(json--Result) code,message,data(str)
 * */
 

 /*
 * 请求方式：post
 * 功能：找回密码
 * 路径 /user/findPassword
 * 传参(json) email
 * 返回值(json--Result) code,message,data(str)
 * */
 
 
 /*
 * 修改用户密码
 * 路径 /user/changePassword
 * 传参(json) email,Password,newPassword,newPasswordRepeat
 * 返回值(json--Result) code,message,data(Str)
 * */
 
 /*
 * 获取用户头像url
 * 路径 /user/getUserTouxiang
 * 传参(json):username/email
 * 返回值(json--Result) code,message,data(url)
 * */
 
 /*
 * 获取用户信息
 * 路径 /user/getUser
 * 传参(json):uid/email
 * 返回值(json--Result) code,message,data((json)user)一个完整的User类实例
 * */

 /*
 * 修改用户信息
 * 路径 /user/updateUser
 * 传参(json) uid(定位需要修改的人） #修改属性#(newUsername,newEmail,newTel等等）
 * 返回值 (json--Result) code,message,data(str)
 * */
 
 /*
 * 请求方式：post
 * 功能：用户新增点亮站点
 * 路径 /user/addLightedStation
 * 传参(json) uid(用户id） pid(站点id) point(积分) time(时间)
 * 返回值 (json--Result) code,message,data(str)
 * */
 
 /*
 * 请求方式：post
 * 功能：用户删除点亮站点
 * 路径 /user/deleteLightedStation
 * 传参(json) uid(用户id） pid(站点id)
 * 返回值 (json--Result) code,message,data(str)
 * */
 
 /*
 * 请求方式：post
 * 功能：用户修改点亮站点
 * 路径 /user/updateLightedStation
 * 传参(json) uid(用户id） pid(站点id) point(积分) time(时间)
 * 返回值 (json--Result) code,message,data(str)
 * */
 
 /*
 * 请求方式：post
 * 功能：用户获取指定点亮站点信息
 * 路径 /user/getLightedStation
 * 传参(json) uid(用户id） pid(站点id)
 * 返回值 (json--Result) code,message,data(str)
 * */
 
 /*
 * 请求方式：post
 * 功能：用户获取个人全部点亮站点信息
 * 路径 /user/getUserLightedStations
 * 传参(json) uid(用户id）
 * 返回值 (json--Result) code,message,data(List<LightedStation>)
 * */
```

